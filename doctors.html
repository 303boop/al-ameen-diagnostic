<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Doctors - Al-Ameen Diagnostic Center</title>
    <meta name="description" content="Meet our expert team of qualified medical professionals.">

    <link rel="icon" href="assets/images/logo/logo.ico">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/utilities.css">
</head>

<body>

    <div id="navbar"></div>

    <section class="bg-primary text-white py-5 position-relative overflow-hidden">
        <div class="container text-center position-relative z-1 py-4">
            <h1 class="display-4 fw-bold" data-i18n="doctors.title" data-aos="fade-down">Our Medical Experts</h1>
            <p class="lead text-white-50 mx-auto" style="max-width: 600px;" data-i18n="doctors.subtitle" data-aos="fade-up" data-aos-delay="100">
                Meet our team of qualified and experienced professionals dedicated to your health.
            </p>
        </div>
        <div class="position-absolute top-0 start-0 w-100 h-100 bg-dark opacity-10"></div>
    </section>

    <section class="section-padding py-5">
        <div class="container">
            
            <div class="row g-3 mb-5 justify-content-center" data-aos="fade-up">
                <div class="col-md-4">
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span>
                        <input type="text" id="doctorSearch" class="form-control border-start-0 ps-0" placeholder="Search by name...">
                    </div>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="specializationFilter">
                        <option value="all">All Specializations</option>
                        </select>
                </div>
            </div>

            <div id="doctorsGrid" class="row g-4">
                <div class="col-md-3"><div class="skeleton-card" style="height: 350px;"></div></div>
                <div class="col-md-3"><div class="skeleton-card" style="height: 350px;"></div></div>
                <div class="col-md-3"><div class="skeleton-card" style="height: 350px;"></div></div>
                <div class="col-md-3"><div class="skeleton-card" style="height: 350px;"></div></div>
            </div>

            <div id="noResults" class="text-center py-5 d-none">
                <i class="fas fa-user-md fa-3x text-muted mb-3 opacity-50"></i>
                <h5 class="text-muted">No doctors found matching your criteria.</h5>
                <button class="btn btn-outline-primary mt-2" onclick="resetFilters()">Clear Filters</button>
            </div>

        </div>
    </section>

    <section class="py-5 bg-light">
        <div class="container text-center">
            <h3>Can't find who you're looking for?</h3>
            <p class="text-muted">Contact our helpdesk for assistance.</p>
            <a href="contact.html" class="btn btn-outline-dark rounded-pill px-4">Contact Us</a>
        </div>
    </section>

    <div id="footer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script src="js/config/supabase.js"></script>
    <script src="js/config/constants.js"></script>

    <script src="js/core/auth.js"></script>
    <script src="js/core/theme.js"></script>
    <script src="js/core/language.js"></script>

    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/date-utils.js"></script>
    <script src="js/utils/toast.js"></script>

    <script src="js/features/filter.js"></script> <script src="js/features/booking.js"></script>

    <script src="js/components/navbar.js"></script>
    <script src="js/components/footer.js"></script>
    <script src="js/components/loader.js"></script>

    <script src="js/main.js"></script>

    <script>
        let allDoctors = [];

        document.addEventListener('DOMContentLoaded', async () => {
            AOS.init({ once: true, duration: 800 });

            await loadDoctorsData();

            // Event Listeners for Filters
            document.getElementById('doctorSearch').addEventListener('input', applyFilters);
            document.getElementById('specializationFilter').addEventListener('change', applyFilters);
        });

        async function loadDoctorsData() {
            try {
                // Fetch Doctors
                const { data, error } = await window.supabase
                    .from('doctors')
                    .select('*')
                    .eq('is_active', true)
                    .order('name');

                if (error) throw error;
                allDoctors = data || [];

                // Populate Dropdown
                populateSpecializations(allDoctors);

                // Initial Render
                renderDoctors(allDoctors);

            } catch (error) {
                console.error("Error loading doctors:", error);
                document.getElementById('doctorsGrid').innerHTML = `<div class="col-12 text-center text-danger">Failed to load doctors list.</div>`;
            }
        }

        function populateSpecializations(doctors) {
            // Use filter.js utility if available, else manual mapping
            const specs = window.filter ? window.filter.getSpecializations(doctors) : [...new Set(doctors.map(d => d.specialization).filter(Boolean))].sort();
            
            const select = document.getElementById('specializationFilter');
            specs.forEach(spec => {
                const option = document.createElement('option');
                option.value = spec;
                option.textContent = spec;
                select.appendChild(option);
            });
        }

        function applyFilters() {
            const query = document.getElementById('doctorSearch').value.toLowerCase();
            const spec = document.getElementById('specializationFilter').value;

            let filtered = allDoctors.filter(doc => {
                const matchesSearch = doc.name.toLowerCase().includes(query) || (doc.specialization && doc.specialization.toLowerCase().includes(query));
                const matchesSpec = spec === 'all' || doc.specialization === spec;
                return matchesSearch && matchesSpec;
            });

            renderDoctors(filtered);
        }

        function renderDoctors(doctors) {
            const container = document.getElementById('doctorsGrid');
            const noResults = document.getElementById('noResults');

            if (doctors.length === 0) {
                container.innerHTML = '';
                noResults.classList.remove('d-none');
                return;
            }

            noResults.classList.add('d-none');
            
            container.innerHTML = doctors.map(doc => `
                <div class="col-xl-3 col-lg-4 col-md-6" data-aos="fade-up">
                    <div class="card h-100 border-0 shadow-sm hover-up doctor-card">
                        <div class="position-relative overflow-hidden" style="height: 250px;">
                            <img src="${doc.image_url || 'assets/images/doctors/placeholder.jpg'}" class="card-img-top w-100 h-100 object-fit-cover" alt="${doc.name}">
                            <div class="doctor-overlay position-absolute bottom-0 start-0 w-100 p-3 bg-dark bg-opacity-75 text-white transform-translate-y-100 transition-all">
                                <a href="doctor-detail.html?id=${doc.id}" class="btn btn-sm btn-light w-100">View Profile</a>
                            </div>
                        </div>
                        <div class="card-body text-center">
                            <h5 class="card-title fw-bold mb-1">${doc.name}</h5>
                            <p class="text-primary small mb-2">${doc.specialization || 'General Physician'}</p>
                            <div class="d-flex justify-content-center gap-2 mb-3">
                                <span class="badge bg-light text-dark border">
                                    <i class="fas fa-rupee-sign me-1"></i>${doc.consultation_fee}
                                </span>
                                <span class="badge bg-light text-dark border">
                                    <i class="fas fa-clock me-1"></i>${window.helpers.formatTime(doc.start_time)} - ${window.helpers.formatTime(doc.end_time)}
                                </span>
                            </div>
                            <a href="booking.html?doctor=${doc.id}" class="btn btn-primary w-100">Book Appointment</a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function resetFilters() {
            document.getElementById('doctorSearch').value = '';
            document.getElementById('specializationFilter').value = 'all';
            renderDoctors(allDoctors);
        }
    </script>

</body>
</html>